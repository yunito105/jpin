plugins {
	id 'java'
	id 'org.springframework.boot' version '3.5.12-SNAPSHOT'
	id 'io.spring.dependency-management' version '1.1.7'
	id 'org.dddjava.jig-gradle-plugin' version '2024.7.1'
}

group = 'com.example'
version = '0.0.1-SNAPSHOT'
description = 'åº—èˆ—ã”æ³¨æ–‡ã‚·ã‚¹ãƒ†ãƒ  - Store Order Management System'

java {
	toolchain {
		languageVersion = JavaLanguageVersion.of(17)
	}
}

repositories {
	mavenCentral()
	maven { url = 'https://repo.spring.io/snapshot' }
}

dependencies {
	// Spring Boot Web
	implementation 'org.springframework.boot:spring-boot-starter-web'
	implementation 'org.springframework.boot:spring-boot-starter-validation'

	// OpenAPI / Swagger UI (springdoc-openapi v2 for Spring Boot 3)
	implementation 'org.springdoc:springdoc-openapi-starter-webmvc-ui:2.8.6'

	// Test
	testImplementation 'org.springframework.boot:spring-boot-starter-test'
	testRuntimeOnly 'org.junit.platform:junit-platform-launcher'

	// ArchUnitï¼ˆã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¦ç´„ãƒ†ã‚¹ãƒˆï¼‰
	testImplementation 'com.tngtech.archunit:archunit-junit5:1.3.0'
}

tasks.named('test') {
	useJUnitPlatform()
}

// JiGè¨­å®š
jig {
	outputDirectory = file("${buildDir}/jig")
}

// Javadocè¨­å®š
javadoc {
	options.encoding = 'UTF-8'
	options.charSet = 'UTF-8'
	options.locale = 'ja'
	options.addStringOption('Xdoclint:none', '-quiet')
	options.links('https://docs.oracle.com/en/java/javase/17/docs/api/')
	options.links('https://docs.spring.io/spring-framework/docs/current/javadoc-api/')
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// å…¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä¸€æ‹¬ç”Ÿæˆã‚¿ã‚¹ã‚¯
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
tasks.register('allDocs') {
	group = 'documentation'
	description = 'å…¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä¸€æ‹¬ç”Ÿæˆï¼ˆJavadoc + JiG + TypeDocï¼‰'
	dependsOn 'javadoc', 'jigReports'

	doLast {
		// ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ TypeDoc ç”Ÿæˆ
		def frontendDir = file("${rootProject.projectDir}/../frontend")
		if (frontendDir.exists()) {
			exec {
				workingDir frontendDir
				if (System.getProperty('os.name').toLowerCase().contains('windows')) {
					commandLine 'cmd', '/c', 'npm', 'run', 'doc'
				} else {
					commandLine 'npm', 'run', 'doc'
				}
			}
			logger.lifecycle("âœ… TypeDoc generated at: frontend/docs/typedoc/index.html")
		} else {
			logger.warn("âš ï¸ frontend directory not found, skipping TypeDoc")
		}

		logger.lifecycle("")
		logger.lifecycle("========================================")
		logger.lifecycle("  ğŸ“š å…¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç”Ÿæˆå®Œäº†!")
		logger.lifecycle("========================================")
		logger.lifecycle("  Javadoc  : build/docs/javadoc/index.html")
		logger.lifecycle("  JiG      : build/jig/index.html")
		logger.lifecycle("  TypeDoc  : ../frontend/docs/typedoc/index.html")
		logger.lifecycle("  OpenAPI  : ./gradlew bootRun â†’ http://localhost:8080/swagger-ui.html")
		logger.lifecycle("========================================")
	}
}
